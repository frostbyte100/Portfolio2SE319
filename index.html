<!doctype html>
<html>
    <head>
        <script src="/socket.io/socket.io.js"></script>
        <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    </head>

    <body>
        <div id="username" style="text-align: right; visibility: hidden">User: n/a</div>
        <h1 style="text-align: center;">Checkers!</h1>
        <form id=getUser style="text-align: center">
            <p>Enter a player name:</p>
            <div id="invalid-name-error" style="display: none">* Player name already in use. Please pick another name *</div><br>
            <input id="name" placeholder="Player Name"><br><br>
            <button>Enter</button>
        </form>

        <div id="gameMenu" style="display: none; text-align: center">
            <h3 id="greeting"></h3>
            <p id="usersOnline"></p>
            <input type="button" id="joinGame" value="Join Game"><br><br>
            <input type="button" id="exitMenu" value="Exit">
        </div>

        <div id="waiting" style="display: none; text-align: center">
            <p>* Waiting for Opponent * </p>
            <img src="http://www.wallpaperama.com/post-images/forums/200903/07p-6606-loading-photo.gif"><br><br>
            <input type="button" id="leaveQue" value="Cancel">
        </div>

        <div id="gameLobby" style="display: none; text-align: center">
            <div id="game" style="float: left"></div>
            <div id="chatbox" style="float: left">
                <h3>Chat Room</h3><hr>
                <div id="msgBox">
                    <ul id="messages" style="list-style-type: none"></ul>
                </div><hr>
                <form id="msgInput">
                    <input id="msg" placeholder="Message" style="word-break: break-word"autocomplete="off">
                    <button>Send</button>
                </form><br>
            </div>
        </div>

    </body>

    <style>
        td {
            width: 75px;
            height: 75px;
        }

        table {
            margin-left: 200px;
        }

        #chatbox {
            border: solid 2px;
            width: 300px;
            margin: 100px;
        }

        #msgBox {
            overflow-y: auto;
            margin: 5px;
            height: 307px;
            width: 290px;
            word-wrap: break-word;
        }

        #messages {
            text-align: left;
            list-style-type: none;
            margin: 0;
            padding: 0;
        }

        #messages li {
            padding-left: 5px;
            padding-right: 5px;
        }

        #messages li:nth-child(odd) {
            background: #f2f2f2;
        }

    </style>

    <script>
        $(function(){
            var socket = io();
            var getUserInterval;
            var username;
            var opponent;

            $("#getUser").submit(function(){
                if($("#name").val().trim() == ''){
                    alert("You must enter a name to play.");
                } else {
                    socket.emit("player enter", $("#name").val(), function(data){
                        if(!data){
                            $("#invalid-name-error").css("display", "block");
                        } else {
                            username = $("#name").val();
                            $("#username").html("User: " + username);
                            $("#username").css("visibility", "visible");
                            $("#invalid-name-error").css("display", "none");
                            $("#greeting").html("Welcome " + $("#name").val() + "!");
                            $("#name").val("");
                            hideTitleScreen();
                            showMenu();
                        }
                    });
                }
                return false;
            });

            $("#joinGame").click(function(){
                socket.emit("join game");
            });

            socket.on("in que", function(){
                hideMenu();
                showWaiting();
            });

            socket.on("joined room", function(name){
                opponent = name;
                hideWaiting();
                hideMenu();
                showLobby();
                createBoard();
            });

            socket.on("chat message", function(msg){
                $("#messages").append("<li><b>" + opponent + ":</b> "+ msg + "</li>");
                scrollToBottom();
            });

            $("#msgInput").submit(function(){
                if($("#msg").val().length > 0){
                    socket.emit("chat message", $("#msg").val());
                    $("#messages").append("<li><b>" + username + ":</b> "+ $("#msg").val() + "</li>");
                    $("#msg").val("");
                    scrollToBottom();
                }
                return false;
            });

            $("#leaveQue").click(function(){
                socket.emit("leave que");
                hideWaiting();
                showMenu();
            });

            $("#exitMenu").click(function(){
                socket.emit("exit menu");
                $("#username").html("User: n/a");
                $("#username").css("visibility", "hidden");
                hideMenu();
                showTitleScreen();
            });

            function createBoard(){
                var board = "<table style='border: solid 10px'>";

                for(row = 0; row < 8; row++){
                    board += "<tr>"

                    for(col = 0; col < 8; col++){
                        if(((row % 2 == 0) && (col % 2 == 1)) || ((row % 2 == 1) && (col % 2 == 0))){
                            board +="<td style='background-color: black'></td>"
                        } else {
                            board +="<td stlye='background-color: red'></td>"
                        }
                    }
                    board +="</tr>";
                }
                board +="</table>";

                $("#game").append(board);
            }

            function showLobby(){
                $("#gameLobby").css("display", "block");
            }

            function hideLobby(){
                $("#gameLobby").css("display", "none");
            }

            function showWaiting(){
                $("#waiting").css("display", "block");
            }

            function hideWaiting(){
                $("#waiting").css("display", "none");
            }

            function showMenu(){
                $("#gameMenu").css("display", "block");
                getUsersOnline();
                getUserInterval = setInterval(getUsersOnline, 5000);
            }

            function hideMenu(){
                $("#gameMenu").css("display", "none");
                clearInterval(getUserInterval);
            }

            function showTitleScreen(){
                $("#getUser").css("display", "block");
            }

            function hideTitleScreen(){
                $("#getUser").css("display", "none");
            }

            function getUsersOnline(){
                socket.emit("get users online", function(data){
                    $("#usersOnline").html("Users Online: " + data);
                });
            }

            function scrollToBottom(){
                $("#msgBox").scrollTop($("#msgBox").prop("scrollHeight"));
            }

        });
    </script>

</html>
